(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{5275:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/assessment",function(){return s(9468)}])},8082:function(e,t,s){"use strict";s.d(t,{Z:function(){return LoadingSpinner}});var n=s(4246);function LoadingSpinner(){return(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}},9468:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return AssessmentPage}});var n=s(4246),a=s(7378),l=s(6677),i=s(4577),r=s(2696),d=s(9138),o=s(8082);function NavigationEditor(e){let{sections:t,onUpdate:s}=e,[l,i]=(0,a.useState)(null),[o,c]=(0,a.useState)({title:"",path:"",parentId:null,order:0,contentPath:""}),handleSectionUpdate=async e=>{try{let t=(0,r.JU)(d.db,"assessmentSections",e.id);await (0,r.r7)(t,{title:e.title,path:e.path,parentId:e.parentId,order:e.order,contentPath:e.contentPath}),i(null),s()}catch(e){console.error("Error updating section:",e)}},handleAddSection=async()=>{try{await (0,r.ET)((0,r.hJ)(d.db,"assessmentSections"),{...o,order:t.length}),c({title:"",path:"",parentId:null,order:0,contentPath:""}),s()}catch(e){console.error("Error adding section:",e)}},handleDeleteSection=async e=>{try{let n=(0,r.qs)(d.db);n.delete((0,r.JU)(d.db,"assessmentSections",e));let a=t.filter(t=>t.id!==e).sort((e,t)=>e.order-t.order);a.forEach((e,t)=>{n.update((0,r.JU)(d.db,"assessmentSections",e.id),{order:t})}),await n.commit(),s()}catch(e){console.error("Error deleting section:",e)}},handleReorder=async(e,n)=>{try{let a=t.findIndex(t=>t.id===e);if("up"===n&&0===a||"down"===n&&a===t.length-1)return;let l=(0,r.qs)(d.db),i="up"===n?a-1:a+1;l.update((0,r.JU)(d.db,"assessmentSections",t[a].id),{order:t[i].order}),l.update((0,r.JU)(d.db,"assessmentSections",t[i].id),{order:t[a].order}),await l.commit(),s()}catch(e){console.error("Error reordering sections:",e)}};return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Add New Section"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Title"}),(0,n.jsx)("input",{type:"text",value:o.title,onChange:e=>c(t=>({...t,title:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Path"}),(0,n.jsx)("input",{type:"text",value:o.path,onChange:e=>c(t=>({...t,path:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Parent Section"}),(0,n.jsxs)("select",{value:o.parentId||"",onChange:e=>c(t=>({...t,parentId:e.target.value||null})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"",children:"None (Root Section)"}),t.map(e=>(0,n.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Content Path"}),(0,n.jsx)("input",{type:"text",value:o.contentPath,onChange:e=>c(t=>({...t,contentPath:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,n.jsx)("button",{onClick:handleAddSection,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:"Add Section"})]})]}),(0,n.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Manage Sections"}),(0,n.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded-md",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h4",{className:"font-medium",children:e.title}),(0,n.jsxs)("p",{className:"text-sm text-gray-500",children:["Path: ",e.path]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("button",{onClick:()=>handleReorder(e.id,"up"),className:"p-1 text-gray-400 hover:text-gray-600",disabled:0===e.order,children:"↑"}),(0,n.jsx)("button",{onClick:()=>handleReorder(e.id,"down"),className:"p-1 text-gray-400 hover:text-gray-600",disabled:e.order===t.length-1,children:"↓"}),(0,n.jsx)("button",{onClick:()=>i(e),className:"p-1 text-blue-600 hover:text-blue-800",children:"Edit"}),(0,n.jsx)("button",{onClick:()=>handleDeleteSection(e.id),className:"p-1 text-red-600 hover:text-red-800",children:"Delete"})]})]},e.id))})]}),l&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md w-full",children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Edit Section"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Title"}),(0,n.jsx)("input",{type:"text",value:l.title,onChange:e=>i(t=>({...t,title:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Path"}),(0,n.jsx)("input",{type:"text",value:l.path,onChange:e=>i(t=>({...t,path:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Content Path"}),(0,n.jsx)("input",{type:"text",value:l.contentPath,onChange:e=>i(t=>({...t,contentPath:e.target.value})),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,n.jsx)("button",{onClick:()=>i(null),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,n.jsx)("button",{onClick:()=>handleSectionUpdate(l),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save"})]})]})]})})]})}function AssessmentViewer(e){let{isAdmin:t=!1}=e,[s,c]=(0,a.useState)([]),[u,m]=(0,a.useState)({currentSectionId:null,expandedSections:[],isEditing:!1}),[h,x]=(0,a.useState)(!0),b=(0,l.useRouter)(),{user:g,signOut:f}=(0,i.a)(),refreshSections=async()=>{try{let e=(0,r.IO)((0,r.hJ)(d.db,"assessmentSections"),(0,r.Xo)("order")),t=await (0,r.PL)(e),s=t.docs.map(e=>({...e.data(),id:e.id}));c(s)}catch(e){console.error("Error fetching assessment sections:",e)}finally{x(!1)}};(0,a.useEffect)(()=>{refreshSections()},[]);let toggleSection=e=>{m(t=>({...t,expandedSections:t.expandedSections.includes(e)?t.expandedSections.filter(t=>t!==e):[...t.expandedSections,e]}))},navigateToSection=e=>{m(t=>({...t,currentSectionId:e.id})),b.push("/assessment/".concat(e.path))};return h?(0,n.jsx)(o.Z,{}):(0,n.jsxs)("div",{className:"flex h-screen bg-gray-100",children:[(0,n.jsxs)("div",{className:"w-64 bg-white shadow-lg flex flex-col",children:[(0,n.jsx)("div",{className:"p-4 border-b",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"Assessment Report"}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[t&&(0,n.jsx)("button",{onClick:()=>{m(e=>({...e,isEditing:!e.isEditing}))},className:"px-3 py-1 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700",children:u.isEditing?"Done":"Edit Navigation"}),(0,n.jsx)("button",{onClick:f,className:"px-3 py-1 text-sm font-medium rounded-md bg-red-600 text-white hover:bg-red-700",children:"Sign Out"})]})]})}),u.isEditing&&t?(0,n.jsx)("div",{className:"flex-1 overflow-auto",children:(0,n.jsx)(NavigationEditor,{sections:s,onUpdate:refreshSections})}):(0,n.jsx)("nav",{className:"p-4 flex-1 overflow-auto",children:s.map(e=>(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsx)("button",{onClick:()=>e.children?toggleSection(e.id):navigateToSection(e),className:"w-full text-left px-2 py-1 rounded hover:bg-gray-100 ".concat(u.currentSectionId===e.id?"bg-blue-50 text-blue-600":""),children:(0,n.jsxs)("span",{className:"flex items-center",children:[e.children&&(0,n.jsx)("span",{className:"mr-2",children:u.expandedSections.includes(e.id)?"▼":"▶"}),e.title]})}),e.children&&u.expandedSections.includes(e.id)&&(0,n.jsx)("div",{className:"ml-4 mt-1 space-y-1",children:e.children.map(e=>(0,n.jsx)("button",{onClick:()=>navigateToSection(e),className:"w-full text-left px-2 py-1 rounded hover:bg-gray-100 ".concat(u.currentSectionId===e.id?"bg-blue-50 text-blue-600":""),children:e.title},e.id))})]},e.id))})]}),(0,n.jsx)("div",{className:"flex-1 overflow-auto",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto py-8 px-4",children:u.isEditing&&t?(0,n.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Navigation Editor Mode"}),(0,n.jsx)("p",{className:"text-gray-600",children:'Use the sidebar to manage the assessment navigation structure. Click "Done" when finished.'})]}):u.currentSectionId?(0,n.jsx)("div",{className:"bg-white shadow-lg rounded-lg p-6"}):(0,n.jsx)("div",{className:"text-center text-gray-500",children:"Select a section from the navigation menu"})})})]})}function AssessmentPage(){let e=(0,l.useRouter)(),{user:t,loading:s}=(0,i.a)();if((0,a.useEffect)(()=>{s||t||e.replace("/login")},[t,s,e]),s)return(0,n.jsx)(o.Z,{});if(!t)return null;let r="admin"===t.role;return console.log("User role:",t.role,"Is admin:",r),(0,n.jsx)(AssessmentViewer,{isAdmin:r})}},6677:function(e,t,s){e.exports=s(6250)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=5275)}),_N_E=e.O()}]);